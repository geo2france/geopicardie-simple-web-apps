<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="./OpenLayers-2.13.1/theme/default/style.css" type="text/css">
    <!--link rel="stylesheet" href="./openlayers/theme/default/style.css" type="text/css"-->
    <link rel="stylesheet" href="style.css" type="text/css">
    <style type="text/css">
        #wmc {
            width: 90%;
            height: 300px;
        }

        /* avoid pink tiles */
        .olImageLoadError {
            background-color: transparent !important;
        }
    </style>

    <!-- JQuery library -->
    <script src="jquery/jquery.min.js"></script>

    <!--script src="../lib/Firebug/firebug.js"></script-->
    <script src="./OpenLayers-2.13.1/OpenLayers.js"></script>
    <!--script src="./openlayers/openlayers.js"></script-->
    <script type="text/javascript">

        // increase reload attempts 
        OpenLayers.IMAGE_RELOAD_ATTEMPTS = 2;
        
        var format = new OpenLayers.Format.WMC({'layerOptions': {buffer: 0}});
        var map;
        
        function init() {
            map = new OpenLayers.Map("map");

            var scan25 = new OpenLayers.Layer.WMS(
                "Global Imagery",
                "http://www.geopicardie.fr/geoserver/wms?",
                {layers: "geopicardie:picardie_scan25"}
            );

            map.addLayers([scan25]);
            map.addControl(new OpenLayers.Control.LayerSwitcher());
            map.setCenter(new OpenLayers.LonLat(2, 45), 6);

            $.get( 'contexts/transport.wmc', function( data ) {
                map.destroy();
//                console.log(data.substring(0, 20));

                var jsonFormat = new OpenLayers.Format.JSON();
                var mapOptions = jsonFormat.read('{"div": "map", "allOverlays": true}');
                map = format.read(data, {map: mapOptions});
                map.addControl(new OpenLayers.Control.LayerSwitcher());
            });
        };
            
    </script>
    </head>
    <body onload="init()">
    <h1 id="title">Contexte cartographique</h1>
    <p id="shortdesc">
        Chargement d'un contexte cartographique produit par le visualiseur du portail de GÃ©oPicardie.
    </p>
    <div id="map" class="smallmap"></div>
  </body>
</html>